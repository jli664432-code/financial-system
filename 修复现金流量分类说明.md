# 修复现金流量分类问题

## 问题分析

您的两笔业务：
1. **第一笔：销售商品**（不涉及现金）
   - 借：应收账款 200
   - 贷：主营业务收入 200
   - ✅ 正确：这笔业务不应该有现金流

2. **第二笔：收到货款**（涉及现金）
   - 借：库存现金 200
   - 贷：应收账款 200
   - ❌ 问题：这笔业务应该有现金流，但可能没有选择现金流量分类

## 解决方案

### 方案1：检查并修复库存现金科目（推荐）

1. **检查库存现金科目设置**：
   - 访问"科目管理"页面
   - 找到"库存现金"科目
   - 确保勾选了"现金/银行"选项
   - 如果没有勾选，请勾选并保存

2. **重新录入收款业务**：
   - 删除之前没有现金流量分类的收款业务
   - 使用"收付款业务"重新录入
   - 系统会自动要求选择现金流量分类
   - 选择"经营活动-销售商品收到的现金"

### 方案2：使用收付款业务类型

对于纯粹的收付款业务，建议使用"收付款业务"类型：

1. 访问"业务流程" -> "创建收付款单"
2. 填写：
   - 业务日期
   - 往来单位：客户名称
   - 摘要：收到货款
   - **现金流量分类**：经营活动-销售商品收到的现金（必选）
3. 添加明细：
   - 借方：库存现金 200
   - 贷方：应收账款 200
   - 金额：200

系统会自动：
- 检测到库存现金是现金类科目
- 强制要求选择现金流量分类
- 在现金流量表中显示

### 方案3：修复已存在的交易（如果已录入）

如果已经录入了收款业务但没有现金流量分类，可以：

1. **删除并重新录入**（推荐）
   - 删除没有现金流量分类的交易
   - 使用"收付款业务"重新录入

2. **或者直接修改数据库**（高级用户）
   - 需要手动更新 splits 表的 cashflow_type_id 字段
   - 不推荐，容易出错

## 现金流量分类说明

### 常见分类

**经营活动**：
- 销售商品收到的现金（INFLOW）
- 购买商品支付的现金（OUTFLOW）
- 支付给职工的现金（OUTFLOW）
- 支付的各项税费（OUTFLOW）

**投资活动**：
- 收回投资收到的现金（INFLOW）
- 购建固定资产支付的现金（OUTFLOW）

**筹资活动**：
- 吸收投资收到的现金（INFLOW）
- 取得借款收到的现金（INFLOW）
- 偿还债务支付的现金（OUTFLOW）

## 检查清单

在录入涉及现金的业务时，请确认：

- [ ] 现金/银行类科目已标记为 `is_cash = True`
- [ ] 选择了正确的现金流量分类
- [ ] 使用了正确的业务类型（收付款业务）
- [ ] 现金流量表中能看到对应的记录

## 注意事项

1. **只有涉及现金/银行科目的业务才需要现金流量分类**
2. **应收账款、应付账款等非现金科目不需要现金流量分类**
3. **现金流量表只显示有现金流量分类的分录**
4. **如果科目被标记为现金类，系统会强制要求选择现金流量分类**

