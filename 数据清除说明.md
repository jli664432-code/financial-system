# 数据库数据清除说明

## ⚠️ 重要提示

**清除数据前请务必备份数据库！此操作不可恢复！**

## 清除方式

### 方式1：使用 Python 脚本（推荐）

#### 方法A：使用完整版脚本（需要激活虚拟环境）

1. 激活虚拟环境：
   ```bash
   .venv312\Scripts\activate  # Windows
   ```

2. 确保已安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

3. 运行脚本：
   ```bash
   python clear_data.py
   ```

#### 方法B：使用简化版脚本（不需要激活虚拟环境）

1. 安装 pymysql（如果还没有）：
   ```bash
   pip install pymysql
   ```

2. 修改 `clear_data_simple.py` 中的数据库连接信息：
   ```python
   DB_CONFIG = {
       "host": "127.0.0.1",
       "port": 3306,
       "user": "root",
       "password": "your_password",  # 修改为您的数据库密码
       "database": "accounting_system",  # 修改为您的数据库名
   }
   ```

3. 运行脚本：
   ```bash
   python clear_data_simple.py
   ```

脚本会提供交互式菜单，您可以选择：
1. **只清除交易数据**（推荐）- 保留科目结构和现金流量分类
2. **完全重置** - 清除所有数据，包括科目

### 方式2：使用 SQL 脚本（最简单）

直接执行 `clear_data.sql` 文件中的 SQL 语句。

**使用 MySQL 命令行**：
```bash
mysql -u root -p accounting_system < clear_data.sql
```

**或使用 MySQL Workbench**：
1. 打开 MySQL Workbench
2. 连接到数据库
3. 打开 `clear_data.sql` 文件
4. 选择要执行的 SQL 语句（模式1或模式2）
5. 执行选中的 SQL

**注意**：SQL 脚本中包含了两种模式的 SQL，请根据需要选择执行。

## 清除内容说明

### 模式1：只清除交易数据

清除以下数据：
- ✅ 业务单据明细 (`business_document_items`)
- ✅ 业务单据 (`business_documents`)
- ✅ 分录明细 (`splits`)
- ✅ 交易凭证 (`transactions`)
- ✅ 重置所有科目余额为 0

**保留**：
- ✅ 会计科目结构 (`accounts`)
- ✅ 现金流量分类 (`cashflow_types`)

**适用场景**：您想保留科目设置，只清除历史交易数据，重新开始记账。

### 模式2：完全重置

清除所有数据，包括：
- ✅ 所有交易数据
- ✅ 所有业务单据
- ✅ 所有科目
- ✅ 所有现金流量分类

**适用场景**：完全重新开始，需要重新设置科目结构。

## 清除后的操作

清除数据后，建议：

1. **如果只清除了交易数据**：
   - 检查科目设置是否符合您的需求
   - 可以开始录入新的交易数据

2. **如果完全重置**：
   - 需要重新设置会计科目
   - 需要重新设置现金流量分类
   - 然后才能开始录入交易数据

## 备份数据库

### MySQL 备份命令

```bash
# 备份整个数据库
mysqldump -u root -p accounting_system > backup_$(date +%Y%m%d_%H%M%S).sql

# 恢复数据库
mysql -u root -p accounting_system < backup_20251120_120000.sql
```

### 使用 MySQL Workbench

1. 打开 MySQL Workbench
2. 选择 "Server" -> "Data Export"
3. 选择要备份的数据库
4. 选择要备份的表
5. 点击 "Start Export"

## 常见问题

**Q: 清除数据后，科目余额会变成什么？**
A: 如果选择"只清除交易数据"，所有科目余额会被重置为 0。如果选择"完全重置"，科目表会被清空。

**Q: 清除后可以恢复吗？**
A: 不可以。请务必在清除前备份数据库。

**Q: 清除数据会影响科目结构吗？**
A: 如果选择"只清除交易数据"，不会影响科目结构。如果选择"完全重置"，会删除所有科目。

